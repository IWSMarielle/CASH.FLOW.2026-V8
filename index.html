<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gyrus & IWS - COMPLETE LIVE PORTAL V17.9</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: #fff; margin: 0; padding: 20px; font-size: 14px; }
        .main-wrapper { max-width: 1600px; margin: 0 auto; }
        .sync-header { background: #1e293b; border: 2px solid #fbbf24; border-radius: 12px; padding: 15px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        .section-divider { width: 100%; text-align: center; margin: 40px 0 20px 0; border-bottom: 3px solid #fbbf24; line-height: 0.1em; }
        .section-divider span { background: #0f172a; padding: 0 15px; color: #fbbf24; font-weight: 900; text-transform: uppercase; font-size: 20px; }
        .dual-container { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        .co-frame { background: #f8fafc; color: #1e293b; border-radius: 12px; padding: 20px; border-top: 6px solid #fbbf24; box-shadow: 0 10px 15px rgba(0,0,0,0.3); }
        .co-header { text-align: center; background: #1e293b; color: #fbbf24; padding: 10px; border-radius: 6px; margin-bottom: 15px; font-weight: 800; font-size: 18px; }
        .cf-section { background: #fff; border: 1px solid #cbd5e1; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .cf-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; gap: 10px; }
        label { font-weight: 700; font-size: 12px; color: #475569; }
        input[type="text"].amt-input { width: 150px; padding: 8px; border: 1px solid #cbd5e1; border-radius: 4px; text-align: right; font-weight: 900; font-family: monospace; font-size: 16px; color: #0f172a; }
        .subtotal-box { margin-top: 10px; padding: 10px; border-radius: 6px; font-weight: 900; text-align: right; font-size: 15px; }
        .sub-liquid { background: #dcfce7; color: #166534; border-left: 5px solid #10b981; }
        .sub-oblig { background: #fee2e2; color: #991b1b; border-left: 5px solid #ef4444; }
        .res-grand { background: #1e293b; color: #fbbf24; text-align: center; padding: 20px; border-radius: 8px; font-size: 32px; font-family: monospace; font-weight: 900; border: 2px solid #fbbf24; }
        .btn-add { background: #1e293b; color: #fbbf24; border: none; padding: 4px 10px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 12px; }
        .sub-label { font-size: 11px; font-weight: 800; color: #1e293b; text-transform: uppercase; margin-top: 15px; padding-bottom: 3px; border-bottom: 2px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
        .date-picker { padding: 6px; border-radius: 4px; border: 1px solid #cbd5e1; font-weight: bold; }
    </style>
</head>
<body>

<div class="main-wrapper">
    <div class="sync-header">
        <div style="color: #10b981; font-weight: 900; letter-spacing: 1px;">● GYRUS & IWS CLOUD PORTAL</div>
        <div id="sync_msg" style="font-size: 12px; opacity: 0.8;">Syncing...</div>
    </div>

    <div class="section-divider"><span>WEEKLY CASH FLOW</span></div>
    <div class="dual-container">
        <div class="co-frame" id="frame_weekly_gyrus">
            <div class="co-header">GYRUS INDUSTRIES CORP</div>
            <div class="cf-section">
                <div class="cf-row"><label>DATE</label><input type="date" id="weekly_gyrus_date" class="date-picker" onchange="autoSave()"></div>
                <div class="cf-row"><label>CASH IN BANK</label><input type="text" id="weekly_gyrus_bank" class="amt-input" onblur="handleAmtBlur(this, 'weekly_gyrus')"></div>
                <div class="sub-label">Accounts Receivable <button class="btn-add" onclick="addRow('weekly_gyrus_ar_list','weekly_gyrus')">+</button></div>
                <div id="weekly_gyrus_ar_list"></div>
                <div class="subtotal-box sub-liquid">TOTAL LIQUID: <span id="weekly_gyrus_total_liquid">0.00</span></div>
            </div>
            <div class="cf-section">
                <div class="cf-row"><label>OPEX</label><input type="text" id="weekly_gyrus_opex" class="amt-input" onblur="handleAmtBlur(this, 'weekly_gyrus')"></div>
                <div class="sub-label">AP: Import <button class="btn-add" onclick="addRow('weekly_gyrus_ap_i','weekly_gyrus')">+</button></div><div id="weekly_gyrus_ap_i"></div>
                <div class="sub-label">AP: Trade <button class="btn-add" onclick="addRow('weekly_gyrus_ap_t','weekly_gyrus')">+</button></div><div id="weekly_gyrus_ap_t"></div>
                <div class="sub-label">AP: Non-Trade <button class="btn-add" onclick="addRow('weekly_gyrus_ap_n','weekly_gyrus')">+</button></div><div id="weekly_gyrus_ap_n"></div>
                <div class="subtotal-box sub-oblig">TOTAL OBLIGATIONS: <span id="weekly_gyrus_total_oblig">0.00</span></div>
            </div>
            <div class="res-grand" id="weekly_gyrus_res_grand">0.00</div>
        </div>

        <div class="co-frame" id="frame_weekly_iws">
            <div class="co-header">IWS-TECHSERV CORP</div>
            <div class="cf-section">
                <div class="cf-row"><label>DATE</label><input type="date" id="weekly_iws_date" class="date-picker" onchange="autoSave()"></div>
                <div class="cf-row"><label>CASH IN BANK</label><input type="text" id="weekly_iws_bank" class="amt-input" onblur="handleAmtBlur(this, 'weekly_iws')"></div>
                <div class="sub-label">Accounts Receivable <button class="btn-add" onclick="addRow('weekly_iws_ar_list','weekly_iws')">+</button></div>
                <div id="weekly_iws_ar_list"></div>
                <div class="subtotal-box sub-liquid">TOTAL LIQUID: <span id="weekly_iws_total_liquid">0.00</span></div>
            </div>
            <div class="cf-section">
                <div class="cf-row"><label>OPEX</label><input type="text" id="weekly_iws_opex" class="amt-input" onblur="handleAmtBlur(this, 'weekly_iws')"></div>
                <div class="sub-label">AP: Import <button class="btn-add" onclick="addRow('weekly_iws_ap_i','weekly_iws')">+</button></div><div id="weekly_iws_ap_i"></div>
                <div class="sub-label">AP: Trade <button class="btn-add" onclick="addRow('weekly_iws_ap_t','weekly_iws')">+</button></div><div id="weekly_iws_ap_t"></div>
                <div class="sub-label">AP: Non-Trade <button class="btn-add" onclick="addRow('weekly_iws_ap_n','weekly_iws')">+</button></div><div id="weekly_iws_ap_n"></div>
                <div class="subtotal-box sub-oblig">TOTAL OBLIGATIONS: <span id="weekly_iws_total_oblig">0.00</span></div>
            </div>
            <div class="res-grand" id="weekly_iws_res_grand">0.00</div>
        </div>
    </div>

    <div class="section-divider"><span>MONTHLY CASH FLOW</span></div>
    <div class="dual-container">
        <div class="co-frame" id="frame_monthly_gyrus">
            <div class="co-header">GYRUS INDUSTRIES CORP (MONTHLY)</div>
            <div class="cf-section">
                <div class="cf-row"><label>MONTH</label><input type="month" id="monthly_gyrus_date" class="date-picker" onchange="autoSave()"></div>
                <div class="cf-row"><label>CASH IN BANK</label><input type="text" id="monthly_gyrus_bank" class="amt-input" onblur="handleAmtBlur(this, 'monthly_gyrus')"></div>
                <div class="sub-label">Accounts Receivable <button class="btn-add" onclick="addRow('monthly_gyrus_ar_list','monthly_gyrus')">+</button></div>
                <div id="monthly_gyrus_ar_list"></div>
                <div class="subtotal-box sub-liquid">TOTAL LIQUID: <span id="monthly_gyrus_total_liquid">0.00</span></div>
            </div>
            <div class="cf-section">
                <div class="cf-row"><label>OPEX</label><input type="text" id="monthly_gyrus_opex" class="amt-input" onblur="handleAmtBlur(this, 'monthly_gyrus')"></div>
                <div class="cf-row"><label style="color:#10b981">SAVINGS</label><input type="text" id="monthly_gyrus_savings" class="amt-input" style="border-color:#10b981" onblur="handleAmtBlur(this, 'monthly_gyrus')"></div>
                <div class="sub-label">AP: Import <button class="btn-add" onclick="addRow('monthly_gyrus_ap_i','monthly_gyrus')">+</button></div><div id="monthly_gyrus_ap_i"></div>
                <div class="sub-label">AP: Trade <button class="btn-add" onclick="addRow('monthly_gyrus_ap_t','monthly_gyrus')">+</button></div><div id="monthly_gyrus_ap_t"></div>
                <div class="sub-label">AP: Non-Trade <button class="btn-add" onclick="addRow('monthly_gyrus_ap_n','monthly_gyrus')">+</button></div><div id="monthly_gyrus_ap_n"></div>
                <div class="subtotal-box sub-oblig">TOTAL OBLIGATIONS: <span id="monthly_gyrus_total_oblig">0.00</span></div>
            </div>
            <div class="res-grand" id="monthly_gyrus_res_grand">0.00</div>
        </div>

        <div class="co-frame" id="frame_monthly_iws">
            <div class="co-header">IWS-TECHSERV CORP (MONTHLY)</div>
            <div class="cf-section">
                <div class="cf-row"><label>MONTH</label><input type="month" id="monthly_iws_date" class="date-picker" onchange="autoSave()"></div>
                <div class="cf-row"><label>CASH IN BANK</label><input type="text" id="monthly_iws_bank" class="amt-input" onblur="handleAmtBlur(this, 'monthly_iws')"></div>
                <div class="sub-label">Accounts Receivable <button class="btn-add" onclick="addRow('monthly_iws_ar_list','monthly_iws')">+</button></div>
                <div id="monthly_iws_ar_list"></div>
                <div class="subtotal-box sub-liquid">TOTAL LIQUID: <span id="monthly_iws_total_liquid">0.00</span></div>
            </div>
            <div class="cf-section">
                <div class="cf-row"><label>OPEX</label><input type="text" id="monthly_iws_opex" class="amt-input" onblur="handleAmtBlur(this, 'monthly_iws')"></div>
                <div class="cf-row"><label style="color:#10b981">SAVINGS</label><input type="text" id="monthly_iws_savings" class="amt-input" style="border-color:#10b981" onblur="handleAmtBlur(this, 'monthly_iws')"></div>
                <div class="sub-label">AP: Import <button class="btn-add" onclick="addRow('monthly_iws_ap_i','monthly_iws')">+</button></div><div id="monthly_iws_ap_i"></div>
                <div class="sub-label">AP: Trade <button class="btn-add" onclick="addRow('monthly_iws_ap_t','monthly_iws')">+</button></div><div id="monthly_iws_ap_t"></div>
                <div class="sub-label">AP: Non-Trade <button class="btn-add" onclick="addRow('monthly_iws_ap_n','monthly_iws')">+</button></div><div id="monthly_iws_ap_n"></div>
                <div class="subtotal-box sub-oblig">TOTAL OBLIGATIONS: <span id="monthly_iws_total_oblig">0.00</span></div>
            </div>
            <div class="res-grand" id="monthly_iws_res_grand">0.00</div>
        </div>
    </div>
</div>

<script>
    const SUPABASE_URL = 'https://nizxofvvevmtvymqivze.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_VKG0gzg572lTNPTn4dzTdA_Jhzbw0zD';
    const f = new Intl.NumberFormat('en-US', { minimumFractionDigits: 2 });
    const parse = (v) => parseFloat(v.toString().replace(/,/g, '')) || 0;
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    function addRow(containerId, pid, name = "", val = "") {
        const div = document.createElement('div');
        div.className = 'cf-row';
        div.style.marginTop = "5px";
        div.innerHTML = `<input type="text" value="${name}" placeholder="..." style="flex:1; padding:8px; border:1px solid #cbd5e1; border-radius:4px;" onblur="autoSave()"><input type="text" value="${val}" class="amt-input sub-val" placeholder="0.00" onblur="handleAmtBlur(this, '${pid}')"><button style="color:red; border:none; background:none; cursor:pointer; font-weight:bold; font-size:16px;" onclick="this.parentElement.remove();calculatePortal('${pid}');autoSave();">×</button>`;
        document.getElementById(containerId).appendChild(div);
    }

    function handleAmtBlur(el, pid) { el.value = f.format(parse(el.value)); calculatePortal(pid); autoSave(); }

    function calculatePortal(pid) {
        let ar = 0; document.querySelectorAll(`#${pid}_ar_list .sub-val`).forEach(e => ar += parse(e.value));
        let ap = 0; 
        [`#${pid}_ap_i`, `#${pid}_ap_t`, `#${pid}_ap_n`].forEach(id => {
            document.querySelectorAll(`${id} .sub-val`).forEach(e => ap += parse(e.value));
        });
        let bank = parse(document.getElementById(`${pid}_bank`).value);
        let opex = parse(document.getElementById(`${pid}_opex`).value);
        let savings = document.getElementById(`${pid}_savings`) ? parse(document.getElementById(`${pid}_savings`).value) : 0;
